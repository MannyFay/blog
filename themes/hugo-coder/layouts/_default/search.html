{{ define "title" }}
  {{ .Title }} Â· {{ .Site.Title }}
{{ end }}

{{ define "content" }}
  <section class="container page">
    <article>
      <header>
        <h1 class="title">{{ .Title }}</h1>
      </header>

      <div class="search-container">
        <input type="search" id="search-input" placeholder="Search for posts..." autofocus />

        <div id="search-results"></div>
      </div>
    </article>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
  <script>
    (function() {
      let fuse;
      const searchInput = document.getElementById('search-input');
      const searchResults = document.getElementById('search-results');

      if (!searchInput || !searchResults) {
        console.error('Search elements not found');
        return;
      }

      // Load search index
      fetch('/index.json')
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to load search index');
          }
          return response.json();
        })
        .then(data => {
          console.log('Loaded search index with', data.length, 'posts');
          const options = {
            keys: ['title', 'content', 'summary', 'tags'],
            includeScore: true,
            threshold: 0.4,
            ignoreLocation: true,
            minMatchCharLength: 2
          };
          fuse = new Fuse(data, options);
          searchInput.disabled = false;
          searchInput.placeholder = 'Search for posts...';
          searchInput.focus();
        })
        .catch(error => {
          console.error('Error loading search index:', error);
          searchResults.innerHTML = '<p class="search-info">Error loading search index</p>';
        });

      // Search on input
      searchInput.addEventListener('input', function(e) {
        const term = e.target.value.trim();

        if (!fuse) {
          searchResults.innerHTML = '<p class="search-info">Loading search index...</p>';
          return;
        }

        if (term.length < 2) {
          searchResults.innerHTML = '<p class="search-info">Enter at least 2 characters to search</p>';
          return;
        }

        const results = fuse.search(term);
        console.log('Search results for "' + term + '":', results);

        if (results.length === 0) {
          searchResults.innerHTML = '<p class="search-info">No results found</p>';
          return;
        }

        let resultsHTML = '<ul class="search-results-list">';
        results.slice(0, 20).forEach(result => {
          const item = result.item;
          resultsHTML += `
            <li class="search-result-item">
              <a href="${item.permalink}" class="search-result-card">
                <span class="search-result-title">${item.title}</span>
                <span class="search-result-date">${item.date}</span>
              </a>
            </li>
          `;
        });
        resultsHTML += '</ul>';

        searchResults.innerHTML = resultsHTML;
      });

      // Disable search input until index is loaded
      searchInput.disabled = true;
      searchInput.placeholder = 'Loading...';
    })();
  </script>
{{ end }}
